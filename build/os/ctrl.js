import Magix from"../lib/magix.js";let GlobalDialogs=[],Prefix="\x1f",BaseZIndex=5e3,WinMinWidth=150,WinMinHeight=100;export default{_o(l,i){GlobalDialogs.push(l),GlobalDialogs[Prefix+l]={_m:BaseZIndex+i,_n:1}},_q(l){delete GlobalDialogs[Prefix+l];for(let i=GlobalDialogs.length;i--;)if(GlobalDialogs[i]==l){GlobalDialogs.splice(i,1);break}this._p()},_n(l){GlobalDialogs[Prefix+l]._n=1},_r(l){GlobalDialogs[Prefix+l]._n=0,this._p()},_s(l,i){let a=i.appId;if(GlobalDialogs[Prefix+a])this._p(a);else{let e=document.createElement("div"),o=GlobalDialogs.length;e.id=a,document.body.append(e),i.zIndex=BaseZIndex+o,i.minWidth||(i.minWidth=WinMinWidth),i.minHeight||(i.minHeight=WinMinHeight),l.owner.mountVframe(e,"~xl/os/dialog",i),this._o(a,o),this._p(a)}},_t(l){let i,a,e;for(let o=GlobalDialogs.length;o--;)if(l){if(GlobalDialogs[o]==l){GlobalDialogs.splice(o,1),a=!0,i=l;break}}else if(i=GlobalDialogs[o],(e=GlobalDialogs[Prefix+i])._n){GlobalDialogs.splice(o,1),a=!0;break}return a&&GlobalDialogs.push(i),a?i:null},_u(){for(let l=GlobalDialogs.length;l--;){let i=GlobalDialogs[l],a=GlobalDialogs[Prefix+i];if(a._m!=BaseZIndex+l){a._m=BaseZIndex+l;let e=Magix.node(i),o=Magix.Vframe.byNode(e);o&&o.invoke("assign",[{zIndex:BaseZIndex+l}])&&o.invoke("render")}}},_p(l,i){let a,e,o;l!=GlobalDialogs._v?((o=GlobalDialogs[Prefix+GlobalDialogs._v])&&o._x&&(o._x=0,(a=Magix.node(GlobalDialogs._v))&&(e=Magix.Vframe.byNode(a))&&e.invoke("_y")),(l=this._t(l))?((o=GlobalDialogs[Prefix+l])._x||(o._x=1,o._n=1,(a=Magix.node(l))&&(e=Magix.Vframe.byNode(a))&&e.invoke("_p"),GlobalDialogs._v=l),this._u()):GlobalDialogs._v=""):i&&(a=Magix.node(l))&&(e=Magix.Vframe.byNode(a))&&(e.invoke("_w"),(o=GlobalDialogs[Prefix+l])._n=0)}};