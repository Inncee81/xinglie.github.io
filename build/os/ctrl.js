/*!1.0.2 kooboy_li@163.com*/
import e from"../lib/magix.js";let t=[],i=0,_=[];export default{_w(e,i){t.push(e),t["\x1f"+e.appId]={_u:5e3+i,_v:1}},_x:()=>t,_z(e){delete t["\x1f"+e];for(let i=t.length;i--;)if(t[i].appId==e){t.splice(i,1);break}this._y()},_v(e){t["\x1f"+e]._v=1},_A(e){t["\x1f"+e]._v=0,this._y()},_B(e,l){let o=l.appId;if(t["\x1f"+o])this._y(o);else{_.length=0;let d=document.createElement("div"),n=t.length;d.id=o,document.body.append(d);let p=Object.assign({},l),a=p.dockX,f=p.dockY,s=0;f||(f=30*i+30,s=1),a||(a=30*i+150,s=1),s&&++i>5&&(i=0),p.left=a,p.top=f,p.zIndex=5e3+n,p.minWidth||(p.minWidth=150),p.minHeight||(p.minHeight=100),e.owner.mountVframe(d,"~xl/os/dialog",p),this._w(p,n),this._y(o)}},_C(e){let i,_,l;for(let o=t.length;o--;)if(i=t[o],e){if(i.appId==e){t.splice(o,1),_=!0;break}}else if((l=t["\x1f"+i.appId])._v){t.splice(o,1),_=!0;break}return _&&t.push(i),_?i:null},_D(){for(let i=t.length;i--;){let _=t[i].appId,l=t["\x1f"+_];if(l._u!=5e3+i){l._u=5e3+i;let t=e.node(_),o=e.Vframe.byNode(t);o&&o.invoke("assign",[{zIndex:5e3+i}])&&o.invoke("render")}}},_y(i,l){let o,d,n;_.length=0,i!=t._E?((n=t["\x1f"+t._E])&&n._G&&(n._G=0,(o=e.node(t._E))&&(d=e.Vframe.byNode(o))&&d.invoke("_H")),(n=this._C(i))?(i=n.appId,(n=t["\x1f"+i])._G||(n._G=1,n._v=1,(o=e.node(i))&&(d=e.Vframe.byNode(o))&&d.invoke("_y"),t._E=i),this._D()):t._E=""):l&&(o=e.node(i))&&(d=e.Vframe.byNode(o))&&(d.invoke("_F"),(n=t["\x1f"+i])._v=0)},_I(){if(_.length){let e=[];for(let t of _)e.push(t);for(let t of e)this._y(t)}else{let i=[];for(let _ of t){if(t["\x1f"+_.appId]._v){let t=e.node(_.appId),l=t&&e.Vframe.byNode(t);l&&(l.invoke("_F"),i.push(_.appId))}}_.push(...i)}}};