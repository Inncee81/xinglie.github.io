import e from"../lib/magix.js";let t=[],i=0,_=[];export default{_t(e,i){t.push(e),t["\x1f"+e.appId]={_r:5e3+i,_s:1}},_u:()=>t,_w(e){delete t["\x1f"+e];for(let i=t.length;i--;)if(t[i].appId==e){t.splice(i,1);break}this._v()},_s(e){t["\x1f"+e]._s=1},_x(e){t["\x1f"+e]._s=0,this._v()},_y(e,l){let o=l.appId;if(t["\x1f"+o])this._v(o);else{_.length=0;let d=document.createElement("div"),n=t.length;d.id=o,document.body.append(d);let p=Object.assign({},l),s=p.dockX,r=p.dockY,a=0;r||(r=30*i+30,a=1),s||(s=30*i+150,a=1),a&&++i>5&&(i=0),p.left=s,p.top=r,p.zIndex=5e3+n,p.minWidth||(p.minWidth=150),p.minHeight||(p.minHeight=100),e.owner.mountVframe(d,"~xl/os/dialog",p),this._t(p,n),this._v(o)}},_z(e){let i,_,l;for(let o=t.length;o--;)if(i=t[o],e){if(i.appId==e){t.splice(o,1),_=!0;break}}else if((l=t["\x1f"+i.appId])._s){t.splice(o,1),_=!0;break}return _&&t.push(i),_?i:null},_A(){for(let i=t.length;i--;){let _=t[i].appId,l=t["\x1f"+_];if(l._r!=5e3+i){l._r=5e3+i;let t=e.node(_),o=e.Vframe.byNode(t);o&&o.invoke("assign",[{zIndex:5e3+i}])&&o.invoke("render")}}},_v(i,l){let o,d,n;_.length=0,i!=t._B?((n=t["\x1f"+t._B])&&n._D&&(n._D=0,(o=e.node(t._B))&&(d=e.Vframe.byNode(o))&&d.invoke("_E")),(n=this._z(i))?(i=n.appId,(n=t["\x1f"+i])._D||(n._D=1,n._s=1,(o=e.node(i))&&(d=e.Vframe.byNode(o))&&d.invoke("_v"),t._B=i),this._A()):t._B=""):l&&(o=e.node(i))&&(d=e.Vframe.byNode(o))&&(d.invoke("_C"),(n=t["\x1f"+i])._s=0)},_F(){if(_.length){let e=[];for(let t of _)e.push(t);for(let t of e)this._v(t)}else{let i=[];for(let _ of t){if(t["\x1f"+_.appId]._s){let t=e.node(_.appId),l=t&&e.Vframe.byNode(t);l&&(l.invoke("_C"),i.push(_.appId))}}_.push(...i)}}};