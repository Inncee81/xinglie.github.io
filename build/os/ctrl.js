import e from"../lib/magix.js";let t=[],l=0,i=[];export default{_n(e,l){t.push(e),t["\x1f"+e.appId]={_l:5e3+l,_m:1}},_o:()=>t,_q(e){delete t["\x1f"+e];for(let l=t.length;l--;)if(t[l].appId==e){t.splice(l,1);break}this._p()},_m(e){t["\x1f"+e]._m=1},_r(e){t["\x1f"+e]._m=0,this._p()},_s(e,_){let p=_.appId;if(t["\x1f"+p])this._p(p);else{i.length=0;let o=document.createElement("div"),n=t.length;o.id=p,document.body.append(o);let d=Object.assign({},_),a=d.dockX,f=d.dockY,s=0;f||(f=30*l+30,s=1),a||(a=30*l+150,s=1),s&&++l>5&&(l=0),d.left=a,d.top=f,d.zIndex=5e3+n,d.minWidth||(d.minWidth=150),d.minHeight||(d.minHeight=100),e.owner.mountVframe(o,"~xl/os/dialog",d),this._n(d,n),this._p(p)}},_t(e){let l,i,_;for(let p=t.length;p--;)if(l=t[p],e){if(l.appId==e){t.splice(p,1),i=!0;break}}else if((_=t["\x1f"+l.appId])._m){t.splice(p,1),i=!0;break}return i&&t.push(l),i?l:null},_u(){for(let l=t.length;l--;){let i=t[l].appId,_=t["\x1f"+i];if(_._l!=5e3+l){_._l=5e3+l;let t=e.node(i),p=e.Vframe.byNode(t);p&&p.invoke("assign",[{zIndex:5e3+l}])&&p.invoke("render")}}},_p(l,_){let p,o,n;i.length=0,l!=t._v?((n=t["\x1f"+t._v])&&n._x&&(n._x=0,(p=e.node(t._v))&&(o=e.Vframe.byNode(p))&&o.invoke("_y")),(n=this._t(l))?(l=n.appId,(n=t["\x1f"+l])._x||(n._x=1,n._m=1,(p=e.node(l))&&(o=e.Vframe.byNode(p))&&o.invoke("_p"),t._v=l),this._u()):t._v=""):_&&(p=e.node(l))&&(o=e.Vframe.byNode(p))&&(o.invoke("_w"),(n=t["\x1f"+l])._m=0)},_z(){if(i.length){let e=[];for(let t of i)e.push(t);for(let t of e)this._p(t)}else{let l=[];for(let i of t){if(t["\x1f"+i.appId]._m){let t=e.node(i.appId),_=t&&e.Vframe.byNode(t);_&&(_.invoke("_w"),l.push(i.appId))}}i.push(...l)}}};