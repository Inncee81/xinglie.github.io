import Magix from"../lib/magix.js";import Dragdrop from"../gallery/mx-dragdrop/index.js";import DialogCtrl from"./ctrl.js";import Exchange from"./exchange.js";let WinShowState=1,WinHideState=2,WinMaxState=4,WinNormalState=8,MinSize=50;export default Magix.View.extend({tmpl:(t,i,e,s)=>{let a,l,h,d,n,o=[],{active:p,maxState:x,left:_,top:g,width:r,height:m,zIndex:c,id:S,appId:u,icon:w,title:y,min:M,max:W,close:f,view:z,scroll:v,resize:k}=t;return h=[],n=[i(0,1,s(w))],a="xl-g",p&&(a+=" xl-h"),d=[i("div",{class:a},n),i(0,0,s(y))],h.push(i("div",{class:"xl-f","mx-mousedown":e+"\x1e_O()",id:s(u)+"_d_t"},d)),d=[],M&&(n=[i("span",{_:"_",class:"xl-k xl-m","mx-click":e+"\x1e_I()"})],d.push(...n)),W&&(a="xl-k xl-n",x&&(a+=" xl-p"),n=[i("span",{"mx-click":e+"\x1e_J()",class:a})],d.push(...n)),f&&(n=[i("span",{_:"a",class:"xl-k xl-l","mx-click":e+"\x1e_L()"})],d.push(...n)),a="xl-i",p&&(a+=" xl-o"),h.push(i("div",{class:a},d)),a="xl-s",v&&(a+=" xl-t"),h.push(i("div",{"mx-view":s(z),class:a})),l="",p&&(l+="display:none"),h.push(i("div",{class:"xl-u",style:l}),i("div",{class:"xl-u xl-v",id:s(S)+"_mk"})),k&&!x&&(a="xl-q",p&&(a+=" xl-r"),d=[i("div",{"mx-mousedown":e+"\x1e_P()",class:a})],h.push(...d)),a="xl-e",p&&(a+=" xl-j"),l="",x||(l+="left:"+s(_)+"px;top:"+s(g)+"px;width:"+s(r)+"px;height:"+s(m)+"px;"),l+="z-index:"+s(c),o.push(i("div",{id:s(S)+"_d","mx-mousedown":e+"\x1e_M()",class:a,style:l},h)),i(e,0,o)},mixins:[Dragdrop],init(t){this.assign(t);let i=t.maxState?WinMaxState:WinNormalState;i|=WinShowState,this._z=i,Exchange.fire("_A",{options:t})},assign(t){return this.set(t),!0},render(){this.digest()},_B(){let t=this._z;t&WinHideState&&(this._z=t^WinHideState|WinShowState,this.root.style.display="")},_w(){let t=this._z;t&WinShowState&&(this._z=t^WinShowState|WinHideState,DialogCtrl._r(this.get("appId")),Exchange.fire("_C",{id:this.get("appId")}),this.root.style.display="none")},_p(){this.digest({active:!0}),this._B(),Exchange.fire("_D",{id:this.get("appId")})},_y(){this.digest({active:!1}),Exchange.fire("_E",{id:this.get("appId")})},_F(){let t=Magix.node(this.id+"_mk");t&&(t.style.display="block")},_G(){let t=Magix.node(this.id+"_mk");t&&(t.style.display="none")},_H(){let t=this._z;t&WinMaxState?(this._z=t^WinMaxState|WinNormalState,this.digest({maxState:!1})):(this._z=t^WinNormalState|WinMaxState,this.digest({maxState:!0}))},"_I<click>"(){this._w()},"_J<click>"(){this._H()},"_L<click>"(t){DialogCtrl._q(this.get("appId"));let i=this.root;this.owner.unmountVframe(),i.parentNode.removeChild(i),Exchange.fire("_K",{id:this.get("appId")})},"_M<mousedown>"(){DialogCtrl._p(this.get("appId"))},"_O<mousedown>"(t){let i=getComputedStyle(document.body),e=parseInt(i.getPropertyValue("--xl-_")),s=document.body.clientWidth,a=document.body.clientHeight-e,l=Magix.node(this.id+"_d").style,{left:h,top:d,width:n}=this.get(),o=!1;this._F(),this._e(t,i=>{o=!0;let p=i.pageX-t.pageX+h;p<MinSize-n?p=MinSize-n:p>s-MinSize&&(p=s-MinSize);let x=i.pageY-t.pageY+d;x<0?x=0:x>a-MinSize+e&&(x=a-MinSize+e),l.left=p+"px",l.top=x+"px",this.set({left:p,top:x})},t=>{if(this._G(),!o&&this.get("max")){let t=Date.now();if(this._N){t-this._N<300?(this._N="",this._H()):this._N=t}else this._N=t}})},"_P<mousedown>"(t){let i=Magix.node(this.id+"_d").style,{width:e,height:s,minWidth:a,minHeight:l}=this.get();this._F(),this._e(t,h=>{let d=h.pageX-t.pageX+e;d<a&&(d=a);let n=h.pageY-t.pageY+s;n<l&&(n=l),i.width=d+"px",i.height=n+"px",this.set({width:d,height:n})},()=>{this._G()})}});