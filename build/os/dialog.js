let t;import i from"../lib/magix.js";import s from"../gallery/mx-dragdrop/index.js";import e from"./ctrl.js";import l from"./exchange.js";export default i.View.extend({tmpl:(i,s,e,l)=>{let h,d,p,o,a,_=[],{show:x,active:n,maxState:m,left:g,top:c,width:r,height:u,zIndex:w,id:y,appId:f,icon:v,title:I,min:k,max:A,close:b,view:j,scroll:H,resize:O}=i;return p=[],a=[s(0,1,l(v))],h="xl-h",n&&(h+=" xl-i"),o=[s("div",{class:h},a),s(0,0,l(I))],p.push(s("div",{class:"xl-g","mx-mousedown":e+"\x1e_P()",id:l(f)+"_d_t"},o)),o=[],k&&(a=[s("span",{_:"_",class:"xl-l xl-n","mx-click":e+"\x1e_K()"})],o.push(...a)),A&&(h="xl-l xl-o",m&&(h+=" xl-q"),a=[s("span",{"mx-click":e+"\x1e_L()",class:h})],o.push(...a)),b&&(a=[s("span",{_:"a",class:"xl-l xl-m","mx-click":e+"\x1e_M()"})],o.push(...a)),h="xl-j",n&&(h+=" xl-p"),p.push(s("div",{class:h},o)),t?o=[t]:(a=[s(0,0,"loading...")],o=[t=s("div",{_:"b",class:"xl-v"},a)]),h="xl-t",H&&(h+=" xl-u"),p.push(s("div",{"mx-view":l(j),class:h},o)),d="",n&&(d+="display:none"),p.push(s("div",{class:"xl-w",style:d}),s("div",{class:"xl-w xl-x",id:l(y)+"_mk"})),O&&!m&&(h="xl-r",n&&(h+=" xl-s"),o=[s("div",{"mx-mousedown":e+"\x1e_Q()",class:h})],p.push(...o)),h="xl-f xl-y",x&&(h+=" xl-z"),n&&(h+=" xl-k"),d="",m||(d+="left:"+l(g)+"px;top:"+l(c)+"px;width:"+l(r)+"px;height:"+l(u)+"px;"),d+="z-index:"+l(w),_.push(s("div",{id:l(y)+"_d","mx-mousedown":e+"\x1e_N()",class:h,style:d},p)),s(e,0,_)},mixins:[s],init(t){this.assign(t);let i=t.maxState?4:8;i|=2,this._A=i,l.fire("_B",{icon:t.icon,title:t.title,appId:t.appId});let s=this.root;this.on("destroy",()=>{e._q(this.get("appId")),s.parentNode.removeChild(s),l.fire("_C",{id:this.get("appId")})})},assign(t){return this.set(t),!0},render(){this.digest()},_D(){let t=this._A;2&t&&(this._A=2^t|1,this.root.style.display="",this.digest({show:!0}))},_w(){let t=this._A;1&t&&(this._A=1^t|2,e._r(this.get("appId")),l.fire("_E",{id:this.get("appId")}),this.digest({show:!1}),this.root.style.display="none")},_p(){this.get("show")?this.digest({active:!0}):(this.set({active:!0}),this._D()),l.fire("_F",{id:this.get("appId")})},_y(){this.digest({active:!1}),l.fire("_G",{id:this.get("appId")})},_H(){let t=i.node(this.id+"_mk");t&&(t.style.display="block")},_I(){let t=i.node(this.id+"_mk");t&&(t.style.display="none")},_J(){let t=this._A;4&t?(this._A=4^t|8,this.digest({maxState:!1})):(this._A=8^t|4,this.digest({maxState:!0}))},"_K<click>"(){this._w()},"_L<click>"(){this._J()},"_M<click>"(t){this.owner.unmountVframe()},"_N<mousedown>"(){e._p(this.get("appId"))},"_P<mousedown>"(t){let s=this._A,e=getComputedStyle(document.body),l=parseInt(e.getPropertyValue("--xl-_")),h=document.body.clientWidth,d=document.body.clientHeight-l,p=i.node(this.id+"_d").style,{left:o,top:a,width:_}=this.get(),x=!1;this._H(),this._d(t,i=>{if(x=!0,4==(4&s))return;let e=i.pageX-t.pageX+o;e<50-_?e=50-_:e>h-50&&(e=h-50);let n=i.pageY-t.pageY+a;n<0?n=0:n>d-50+l&&(n=d-50+l),p.left=e+"px",p.top=n+"px",this.set({left:e,top:n})},t=>{if(this._I(),!x&&this.get("max")){let t=Date.now();if(this._O){t-this._O<300?(this._O="",this._J()):this._O=t}else this._O=t}})},"_Q<mousedown>"(t){let s=i.node(this.id+"_d").style,{width:e,height:l,minWidth:h,minHeight:d}=this.get();this._H(),this._d(t,i=>{let p=i.pageX-t.pageX+e;p<h&&(p=h);let o=i.pageY-t.pageY+l;o<d&&(o=d),s.width=p+"px",s.height=o+"px",this.set({width:p,height:o})},()=>{this._I()})}});