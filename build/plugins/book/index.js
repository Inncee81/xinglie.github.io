let e,t={class:"xl-a_"},a={class:"xl-X"},l={class:"xl-aa"},r={class:"xl-ab"},o={class:"xl-ae"};import s from"../../lib/magix.js";import i from"./db.js";s.applyStyle("xle",".xl-W{flex:0.3;padding:3px 4px;height:30px;font-size:16px;box-sizing:border-box;box-shadow:none;border:1px solid #ccc;background-color:#fff;vertical-align:middle;width:100%;outline:none}.xl-X{flex:0.6}.xl-Y{float:left;padding:0 8px;cursor:pointer}.xl-Z{background:#fafafa;color:#000}.xl-a_{background:#f96447;height:40px;line-height:40px;color:#fff;padding:0 10px;font-size:16px;display:flex;align-items:center}.xl-aa{background:#fafafa;color:#333;height:28px;line-height:28px;position:-webkit-sticky;position:sticky;top:0;font-weight:700}.xl-aa,.xl-ab{padding:0 26px}.xl-ac{padding:5px 0}.xl-ad{border-bottom:1px solid #f3f3f3}.xl-ae{position:-webkit-sticky;position:sticky;bottom:0;height:30px;background:#fafafa;line-height:30px}.xl-af,.xl-ae{padding:0 26px}.xl-af{font-size:16px;height:50px;line-height:50px}.xl-ag{text-decoration:none;margin-right:10px}.xl-ag:hover{text-decoration:underline}");let p=(e,t)=>e.py.localeCompare(t.py),n=[{name:"\u4e66\u540d",key:"py"},{name:"\u4f5c\u8005",key:"apy"},{name:"\u51fa\u7248",key:"ppy"}],h={py:["title","category","author","translater","publisher"],apy:["author","category","title","translater","publisher"],cpy:["category","title","author","translater","publisher"],ppy:["publisher","category","title","author","translater"]},c={py:["py","title"],apy:["apy","author"],cpy:["cpy","category"],ppy:["ppy","publisher"]},x={title:"\u4e66\u540d",category:"\u5927\u7c7b",author:"\u4f5c\u8005",translater:"\u7ffb\u8bd1",publisher:"\u51fa\u7248"},f=e=>e.title.replace(/-/g," ")+" "+e.author;export default s.View.extend({tmpl:(s,i,p,n,h,c,x,f)=>{let g,d,u,y,b,k,m,_,v,w,C=[],{tabs:q,active:z,search:j,list:S,displays:T,keyMap:M,uncode:W,total:X}=s;d=[];for(let e=0,t=q,a=t.length;e<a;e++){let a=t[e];b=[i(0,0,n(a.name))],y="xl-Y",a.key==z&&(y+=" xl-Z"),u=[i("li",{"mx-click":a.key!=z&&p+"\x1e_ae({tab:'"+f(a.key)+"'})",class:y},b)],d.push(...u)}g=[i("ul",a,d),i("input",{class:"xl-W",placeholder:"\u641c\u7d22","mx-input":p+"\x1e_ah()",value:n(j)},0,1)],C.push(i("div",t,g));let Y=0;if(S.length){g=[];for(let e=0,t=S,a=t.length;e<a;e++){let a=t[e];b=[i(0,0,n(a.letter))],u=[i("div",l,b)],b=[];for(let e=0,t=a.books,l=t.length,r=l-1;e<l;e++){let a=t[e],l=e===r;m=[],Y++;for(let e=0,t=T,l=t.length;e<l;e++){let l=t[e];_=[],a[l]&&(w=[i(0,0,n(M[l])+"\uff1a"+n(a[l]))],v=[i("div",0,w)],_.push(...v)),m.push(..._)}_=[i(0,0,"\u641c\u7d22\uff1a")],v=[i(0,0,"\u767e\u5ea6")],_.push(i("a",{class:"xl-ag",href:"//www.baidu.com/s?wd="+h(W(a)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u6dd8\u5b9d")],_.push(i("a",{class:"xl-ag",href:"//s.taobao.com/search?q="+h(W(a)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u5929\u732b")],_.push(i("a",{class:"xl-ag",href:"//list.tmall.com/search_product.htm?q="+h(W(a)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u4eac\u4e1c")],_.push(i("a",{class:"xl-ag",href:"//search.jd.com/Search?keyword="+h(W(a))+"&enc=utf-8&wq="+h(W(a)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u5f53\u5f53")],_.push(i("a",{class:"xl-ag",href:"http://search.dangdang.com/?key="+h(W(a)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u8c46\u74e3")],_.push(i("a",{class:"xl-ag",href:"//www.douban.com/search?cat=1001&q="+h(W(a)),target:"_blank",rel:"noopener noreferrer"},v)),m.push(i("div",0,_)),y="xl-ac",l||(y+=" xl-ad"),k=[i("li",{class:y},m)],b.push(...k)}u.push(i("ul",r,b)),d=[i("div",0,u)],g.push(...d)}C.push(...g)}else e?g=[e]:(d=[i(0,0,"\u6682\u65e0\u76f8\u5173\u4e66\u7c4d")],g=[e=i("div",{_:"_",class:"xl-af"},d)]),C.push(...g);return g=[i(0,0,"\u5171"+n(X)+"\u672c\uff0c\u5f53\u524d\u5217\u8868\u6709")],d=[i(0,0,n(Y))],g.push(i("span",0,d),i(0,0,"\u672c")),C.push(i("div",o,g)),i(p,0,C)},ctor(){this.set({uncode:f,active:"py"})},render(){let e=[],t={},a=this.get("active"),l=this.get("search");for(let e of i)if(e[a]){let r=e[a][0].toLowerCase();if(l){let o=!1,s=c[a];for(let t of s)e[t].indexOf(l)>-1&&(o=!0,BarProp);o&&(t[r]||(t[r]=[]),t[r].push(e))}else t[r]||(t[r]=[]),t[r].push(e)}for(let a,l,r=48;r<123;r++)(l=t[a=String.fromCharCode(r)])&&(l=l.sort(p),e.push({letter:a.toUpperCase(),books:l}));this.digest({total:i.length,tabs:n,list:e,displays:h[a],keyMap:x})},"_ae<click>"(e){this.set({active:e.params.tab}),this.render()},"_ah<input>"(e){this.set({search:e.eventTarget.value}),clearTimeout(this._af);let t=s.mark(this,"_ag");this._af=setTimeout(()=>{t()&&this.render()},500)}});