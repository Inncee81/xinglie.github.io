let e,a={class:"xl-ac"},t={class:"xl-a_"},l={class:"xl-ad"},r={class:"xl-ae"},o={class:"xl-ah"};import s from"../../lib/magix.js";import i from"./db.js";s.applyStyle("xle",".xl-Z{flex:0.3;padding:3px 4px;height:30px;font-size:16px;box-sizing:border-box;box-shadow:none;border:1px solid #ccc;background-color:#fff;vertical-align:middle;width:100%;outline:none}.xl-a_{flex:0.6}.xl-aa{float:left;padding:0 8px;cursor:pointer}.xl-ab{background:#fafafa;color:#000}.xl-ac{background:#f96447;height:40px;line-height:40px;color:#fff;padding:0 10px;font-size:16px;display:flex;align-items:center}.xl-ad{background:#fafafa;color:#333;height:28px;line-height:28px;position:-webkit-sticky;position:sticky;top:0;font-weight:700}.xl-ad,.xl-ae{padding:0 26px}.xl-af{padding:5px 0}.xl-ag{border-bottom:1px solid #f3f3f3}.xl-ah{position:-webkit-sticky;position:sticky;bottom:0;height:30px;background:#fafafa;line-height:30px}.xl-ai,.xl-ah{padding:0 26px}.xl-ai{font-size:16px;height:50px;line-height:50px}.xl-aj{text-decoration:none;margin-right:10px}.xl-aj:hover{text-decoration:underline}");let p=(e,a)=>e.py.localeCompare(a.py),h=[{name:"\u4e66\u540d",key:"py"},{name:"\u4f5c\u8005",key:"apy"},{name:"\u51fa\u7248",key:"ppy"}],n={py:["title","category","author","translater","publisher"],apy:["author","category","title","translater","publisher"],cpy:["category","title","author","translater","publisher"],ppy:["publisher","category","title","author","translater"]},c={py:["py","title"],apy:["apy","author"],cpy:["cpy","category"],ppy:["ppy","publisher"]},x={title:"\u4e66\u540d",category:"\u5927\u7c7b",author:"\u4f5c\u8005",translater:"\u7ffb\u8bd1",publisher:"\u51fa\u7248"},d=e=>e.title.replace(/-/g," ")+" "+e.author;export default s.View.extend({tmpl:(s,i,p,h,n,c,x,d)=>{let f,u,g,y,b,k,m,_,v,w,j=[],{tabs:C,active:q,search:z,list:S,displays:T,keyMap:M,uncode:Z,total:B}=s;u=[];for(let e=0,a=C,t=a.length;e<t;e++){let t=a[e];b=[i(0,0,h(t.name))],y="xl-aa",t.key==q&&(y+=" xl-ab"),g=[i("li",{"mx-click":t.key!=q&&p+"\x1e_ae({tab:'"+d(t.key)+"'})",class:y},b)],u.push(...g)}f=[i("ul",t,u),i("input",{class:"xl-Z",placeholder:"\u641c\u7d22","mx-input":p+"\x1e_ah()",value:h(z)},0,1)],j.push(i("div",a,f));let L=0;if(S.length){f=[];for(let e=0,a=S,t=a.length;e<t;e++){let t=a[e];b=[i(0,0,h(t.letter))],g=[i("div",l,b)],b=[];for(let e=0,a=t.books,l=a.length,r=l-1;e<l;e++){let t=a[e],l=e===r;m=[],L++;for(let e=0,a=T,l=a.length;e<l;e++){let l=a[e];_=[],t[l]&&(w=[i(0,0,h(M[l])+"\uff1a"+h(t[l]))],v=[i("div",0,w)],_.push(...v)),m.push(..._)}_=[i(0,0,"\u641c\u7d22\uff1a")],v=[i(0,0,"\u767e\u5ea6")],_.push(i("a",{class:"xl-aj",href:"//www.baidu.com/s?wd="+n(Z(t)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u6dd8\u5b9d")],_.push(i("a",{class:"xl-aj",href:"//s.taobao.com/search?q="+n(Z(t)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u5929\u732b")],_.push(i("a",{class:"xl-aj",href:"//list.tmall.com/search_product.htm?q="+n(Z(t)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u4eac\u4e1c")],_.push(i("a",{class:"xl-aj",href:"//search.jd.com/Search?keyword="+n(Z(t))+"&enc=utf-8&wq="+n(Z(t)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u5f53\u5f53")],_.push(i("a",{class:"xl-aj",href:"http://search.dangdang.com/?key="+n(Z(t)),target:"_blank",rel:"noopener noreferrer"},v)),v=[i(0,0,"\u8c46\u74e3")],_.push(i("a",{class:"xl-aj",href:"//www.douban.com/search?cat=1001&q="+n(Z(t)),target:"_blank",rel:"noopener noreferrer"},v)),m.push(i("div",0,_)),y="xl-af",l||(y+=" xl-ag"),k=[i("li",{class:y},m)],b.push(...k)}g.push(i("ul",r,b)),u=[i("div",0,g)],f.push(...u)}j.push(...f)}else e?f=[e]:(u=[i(0,0,"\u6682\u65e0\u76f8\u5173\u4e66\u7c4d")],f=[e=i("div",{_:"_",class:"xl-ai"},u)]),j.push(...f);return f=[i(0,0,"\u5171"+h(B)+"\u672c\uff0c\u5f53\u524d\u5217\u8868\u6709")],u=[i(0,0,h(L))],f.push(i("span",0,u),i(0,0,"\u672c")),j.push(i("div",o,f)),i(p,0,j)},ctor(){this.set({uncode:d,active:"py"})},render(){let e=[],a={},t=this.get("active"),l=this.get("search");for(let e of i)if(e[t]){let r=e[t][0].toLowerCase();if(l){let o=!1,s=c[t];for(let a of s)e[a].indexOf(l)>-1&&(o=!0,BarProp);o&&(a[r]||(a[r]=[]),a[r].push(e))}else a[r]||(a[r]=[]),a[r].push(e)}for(let t,l,r=48;r<123;r++)(l=a[t=String.fromCharCode(r)])&&(l=l.sort(p),e.push({letter:t.toUpperCase(),books:l}));this.digest({total:i.length,tabs:h,list:e,displays:n[t],keyMap:x})},"_ae<click>"(e){this.set({active:e.params.tab}),this.render()},"_ah<input>"(e){this.set({search:e.eventTarget.value}),clearTimeout(this._af);let a=s.mark(this,"_ag");this._af=setTimeout(()=>{a()&&this.render()},500)}});