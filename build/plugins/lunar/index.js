let e,t,a={class:"xl-aU"},o={class:"xl-aS"},l={class:"xl-aV"},s={class:"xl-aW"},r={class:"xl-aX"},i={class:"xl-aY"},d={class:"xl-a4"},n={class:"xl-a5"};import p from"../../lib/magix.js";import h from"../../gallery/mx-dragdrop/index.js";import x from"../../lib/cron.js";import y from"./days.js";p.applyStyle("xl-n",'.xl-aR{background:rgba(0,0,0,.13333333333333333);border-radius:5px;overflow:hidden;opacity:.1;transition:all .5s}.xl-aR:hover{opacity:.8}.xl-aS{height:4px;background:#bbb}.xl-aT{height:100%;background:#888}.xl-aU{border-radius:4px;background:rgba(0,0,0,.6666666666666666);transform:translate(100px,-40px);position:absolute;left:0;top:0;padding:4px;font-size:12px}.xl-aU:after{content:" ";width:0;height:0;position:absolute;border:6px solid transparent;border-top-color:rgba(0,0,0,.6666666666666666);left:50%;top:100%}.xl-aV{position:absolute;left:0;right:0;bottom:0;font-size:140px;color:hsla(0,0%,100%,.13333333333333333);cursor:move}.xl-aV,.xl-aW{text-align:center}.xl-aW{border-collapse:collapse;width:100%;border-spacing:0}.xl-aX{background:rgba(0,0,0,.3333333333333333)}.xl-aY{font-size:18px}.xl-aZ{cursor:pointer;padding:0;border-radius:4px;width:50px;height:30px;position:relative}.xl-a0,.xl-a0:hover{background:rgba(0,0,0,.26666666666666666)}.xl-a1{color:red}.xl-a2{color:green}.xl-a3{right:5px;top:-2px}.xl-a3,.xl-a4{position:absolute;font-size:12px;transform:scale(.6)}.xl-a4{right:-3px;bottom:-4px}.xl-a5{position:absolute;left:3px;top:-7px;font-size:12px;transform:scale(.6)}.xl-a6{color:#ffd73a}');let g="\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split(""),m={year:2012,month:12,day:22,name:"\u599e\u599e"};export default p.View.extend({tmpl:(p,h,x,y)=>{let g,m,u,c,b,f,w,k,v,T,D,_,S,M=[],{esDays:z,days:R,percent:Y,month:j,weekText:V,weeks:W,year:X,day:H,workdays:U,holidays:$,birthday:q,solarTerms:C}=p;u="";let F=Math.ceil(z);u+=" \u4eca\u5e74\u5171"+y(R)+"\u5929\uff0c ",m=[h(0,u+=0==F?" \u4eca\u5929\u662f\u6700\u540e\u4e00\u5929 ":" \u8fd8\u6709"+y(F)+"\u5929 ")],g=[h("div",a,m)],m=[h("div",{class:"xl-aT",style:"width:"+y(Y)+"%"})],g.push(h("div",o,m)),m=[h(0,y(j))],g.push(h("div",l,m)),c=[],b=[];for(let e=V.length,t=0;t<e;t+=1){w=[h(0,y(V[t]))],f=[h("td",r,w)],b.push(...f)}c.push(h("tr",0,b));for(let a=W.length,o=0;o<a;o+=1){let a=W[o];f=[];for(let o=a.length,l=0;l<o;l+=1){let o=a[l],s=`${o.year}-${o.month}-${o.day}`;T=[],o.otherMonth||(D=[],_=[h(0,y(o.day))],D.push(h("div",i,_)),1===U[s]?(e?_=[e]:(S=[h(0,"\u73ed")],_=[e=h("div",{_:"_",class:"xl-a3"},S)]),D.push(..._)):1===$[s]&&(t?_=[t]:(S=[h(0,"\u5047")],_=[t=h("div",{_:"a",class:"xl-a3"},S)]),D.push(..._)),C[s]&&(S=[h(0,y(C[s]))],_=[h("div",d,S)],D.push(..._)),o.month==q.month&&o.day==q.day&&(S=[h(0,y(q.name))],_=[h("div",n,S)],D.push(..._)),T.push(...D)),k="xl-aZ",o.year==X&&o.month==j&&o.day==H&&(k+=" xl-a0"),1===U[s]?k+=" xl-a1":1===$[s]&&(k+=" xl-a2"),o.month==q.month&&o.day==q.day&&(k+=" xl-a6"),v=y(s),1===U[s]?v+=" \u4e0a\u73ed":1===$[s]&&(v+=" \u653e\u5047"),v+=" ",C[s]&&(v+=""+y(C[s])),v+=" ",o.month==q.month&&o.day==q.day&&(v+=y(q.name)+"\u751f\u65e5\uff0c\u4eca\u5e74"+y(o.year-q.year)+"\u5c81\u5566\uff5e"),w=[h("td",{class:k,title:!o.otherMonth&&v},T)],f.push(...w)}b=[h("tr",0,f)],c.push(...b)}return m=[h("tbody",0,c)],g.push(h("table",s,m)),M.push(h("div",{class:"xl-aR","mx5-mousedown":x+"\x1e_aR()"},g)),h(x,0,M)},init(){this.set({birthday:m,weekText:g,weekStart:0});let e=this.render.bind(this);x._s(e,6e5),this.ondestroy=()=>{x._t(e)}},assign:()=>!1,async render(){let e=new Date,t=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),l=new Date(t,0,1,0,0,0).getTime(),s=new Date(t+1,0,1,0,0,0).getTime();e.setHours(0,0,0,0);let r,i=(e.getTime()-l+864e5)/(s-l)*100,d=(s-l)/864e5,n=(s-e.getTime()-864e5)/864e5,h=(7-this.get("weekStart")+new Date(t,a-1,1).getDay())%7,x=[],g=[],m=((e,t)=>32-new Date(e,t-1,32).getDate())(t,a);for(r=1;r<=h;r++)g.push({otherMonth:!0});for(r=1;r<=m;r++)g.push({year:t,day:r,month:a}),(r+h)%7==0&&(x.push(g),g=[]);let u=g.length;if(u){let e=7;for(r=u;r<e&&(g.push({otherMonth:!0}),(r+1)%7!=0||(x.push(g),g=[],6!=x.length));r++);}let c=p.mark(this,"_aH"),{queryWorkAndHolidays:b,querySolarTerms:f}=y,[w,{workdays:k,holidays:v}]=await Promise.all([f(),b(e)]);c()&&this.digest({year:t,holidays:v,workdays:k,solarTerms:w,month:a,day:o,days:d,esDays:n,percent:i.toFixed(2),weeks:x})},"_aR<mousedown>"(e){let t=this.root,a=parseInt(getComputedStyle(t).left),o=parseInt(getComputedStyle(t).top);this._d(e,l=>{let s=l.pageX-e.pageX,r=l.pageY-e.pageY,i=a+s,d=o+r;t.style.left=i+"px",t.style.top=d+"px"})}}).merge(h);