var e=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(h,n){function r(e){try{a(s.next(e))}catch(e){n(e)}}function _(e){try{a(s.throw(e))}catch(e){n(e)}}function a(e){e.done?h(e.value):new i(function(t){t(e.value)}).then(r,_)}a((s=s.apply(e,t||[])).next())})};import t from"../../lib/magix.js";let i="https://jirenguapi.applinzi.com/fm",s=[],h=[],n=new t.Cache(200,50);export default Object.assign({_bc:()=>fetch(`${i}/getChannels.php`).then(e=>e.json()),_bd:e=>fetch(`${i}/getSong.php?channel=${e}`).then(e=>e.json()),_b_(e){let t=`${i}/getLyric.php?sid=${e}`;return n.has(t)?Promise.resolve(n.get(t)):fetch(t).then(e=>e.json()).then(e=>(n.set(t,e),Promise.resolve(e)))},_aw(){return e(this,void 0,void 0,function*(){let{channels:e}=yield this._bc();return{active:e[0],channels:e}})},_bi(e){if(this._be){clearTimeout(this._bf);let i=this._bg;i||(i={play:!1,buffer:!1});let s=["play","buffer"];for(let h of s)t.has(e,h)||(e[h]=i[h]);this._bg=e,this._bf=setTimeout(()=>{let t=!1;if(i=this._bh){for(let h of s)if(i[h]!=e[h]){t=!0;break}}else t=!0;t&&this.fire("_aB",this._bh=e)},50)}},_bj(){let e=this._be;if(e){let t=e.buffered,i=0;t.length&&(i=t.end(t.length-1)/e.duration),this.fire("_aS",{duration:e.duration,current:e.currentTime,buffered:i})}},_bn(){if(!this._be){let e,t=new Audio;t.onprogress=(()=>{this._bj()}),t.onerror=(()=>{clearTimeout(e),e=setTimeout(()=>{this.fire("_ay")},2e3)}),t.onended=(()=>{clearTimeout(e),e=setTimeout(()=>{this.fire("_ay")},1e3)}),t.onvolumechange=(()=>{this.fire("_bk",{volume:t.volume})}),t.oncanplay=(()=>{this._bi({buffer:!1})}),t.onwaiting=(()=>{this._bi({buffer:!0})}),t.ontimeupdate=(()=>{this._bl||this._bj()}),t.onplaying=(()=>{this._bi({play:!0})}),t.ondurationchange=(()=>{this._bl||this._bj()}),t.onpause=(()=>{this._bi({play:t.ended})}),t.onloadedmetadata=(()=>{let e=this._bm,t=!1;for(let i of h)if(i.sid==e.sid){t=!0;break}if(!t)for(let i of s)if(i.sid==e.sid){t=!0;break}t||h.push(e),h.length>50&&h.shift(),this.fire("_aC",{song:e})}),this._be=t}},_bo(e){this._bn(),this._be.src=e.url,this._be.play().catch(e=>{}),this._bm=e},_bp(e){if(this._be){let t=this._be.seekable,i=t.length;if(i){let s=t.start(0),h=t.end(i-1);e>=s&&e<=h&&(this._be.currentTime=e)}else{let e=this._be.buffered;if(e.length){let t=e.end(e.length-1);this._be.currentTime=t}}}},_br(e,t,i){clearTimeout(this._bq),this._bq=setTimeout(()=>{this._az(e,t)},i)},_az(i,n){return e(this,void 0,void 0,function*(){if(this._aH(),this._bi({buffer:!0}),n||(n=0==s.length),n)try{let e=t.mark(this,"_az"),{song:s}=yield this._bd(i);if(e()){let e=s[0];e.url?(this.fire("_aD",{song:e}),this._bo(e)):this._br(i,n,50)}}catch(e){this._br(i,n,2e3)}else{let e=s.pop();h.push(e),this._bo(e),this.fire("_aD",{song:e})}})},_aM(){if(h.length>1){this._aH(),this._bi({buffer:!0});let e=h.pop();s.push(e),e=h[h.length-1],this._bo(e),this.fire("_aD",{song:e})}},_aP(){return this._be},_aG:()=>h.length>1,_bs(e){this._be&&(this._be.volume=e)},_aH(){this._be&&this._be.pause()},_aI(){this._be&&this._be.play()},_bt(){let e=this._be;return!!e&&(e.muted=!e.muted,e.muted)},_aA(){this._be&&(this._be.currentTime=0,this._be.play())},_aE(){if(h.length>1){let e=h[h.length-2];return"\u4e0a\u4e00\u9996\uff1a"+e.title+"-"+e.artist}return"\u4e0a\u4e00\u9996\uff1a\u6682\u65e0\u5386\u53f2\u6b4c\u66f2"},_aF(){if(s.length){let e=s[s.length-1];return"\u4e0b\u4e00\u9996\uff1a"+e.title+"-"+e.artist}return"\u4e0b\u4e00\u9996\uff1a\u968f\u673a\u6b4c\u66f2"},_aQ(e){this._bl=e,e||this._bj()}},t.Event);