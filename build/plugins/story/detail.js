/*!1.0.5 kooboy_li@163.com*/
import"./story.js";let s;import t from"../../lib/magix.js";import l from"../../lib/agent.js";let e=/<dt>\s*<span>([\s\S]+?)<\/span>\s*<\/dt>\s*([\s\S]+?)<\/dl>/g,i=/<dd>\s*<span\s*class="maglisttitle">\s*<a[^>]*?href="([^"]+)"[^>]*?>([\s\S]+?)<\/a>\s*<\/span>\s*<\/dd>/g;export default t.View.extend({tmpl:(t,l,e,i,r,a,o,h)=>{let c,d,n,g,p,u,x=[],{loading:m,error:y,showStory:f,list:w,storyUrl:S}=t;if(m)s?c=[s]:(d=[l(0,0,"loading...")],c=[s=l("div",{_:"_",class:"xl-w"},d)]),x.push(...c);else if(y)c=[l(0,0,i(y))],x.push(...c);else{d=[];for(let s=w.length,t=0;t<s;t++){let s=w[t];g=[],p=[l(0,0,i(s.title))],g.push(l("div",{class:"xl-cf",title:i(s.title)},p));for(let t=s.links,r=t.length,a=0;a<r;a++){let s=t[a];u=[l(0,0,i(s.text))],p=[l("div",{class:"xl-cg",title:i(s.text),"mx-click":e+"\x1e_ci({url:'"+h(s.url)+"'})"},u)],g.push(...p)}d.push(...g)}n="xl-ce",f&&(n+=" xl-ch"),c=[l("div",{class:n},d)],x.push(...c)}return n="xl-ci",f&&(n+=" xl-cj"),x.push(l("div",{"mx-view":"~xl/plugins/story/story?url="+r(S),"mx-close":e+"\x1e_cj()",class:n})),l(e,0,x)},init(){this.set({showStory:!1,storyUrl:""})},assign(s){return this.set(s).set({loading:!0,showStory:!1}),!0},async render(){this.digest();try{let s=t.mark(this,"_aR"),r=this.get("data"),a=r.lastIndexOf("/"),o=r.substring(0,a+1),h=await l.request(r,2592e6,!0);if(s()){let s=[];h.replace(e,(t,l,e)=>{let r=[];return e.replace(i,(s,t,l)=>(r.push({url:o+t,text:l.trim()}),s)),s.push({title:l.trim(),links:r}),t}),this.digest({list:s,loading:!1})}}catch(s){this.digest({loading:!1,error:s})}},"_ci<click>"(s){this.digest({showStory:!0,storyUrl:s.params.url})},"_cj<close>"(){this.digest({showStory:!1})}});