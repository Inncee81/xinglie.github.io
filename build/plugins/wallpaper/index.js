/*!1.0.2 kooboy_li@163.com*/
import"../../gallery/mx-more/index.js";let t,e={class:"xl-cm"},i={class:"xl-cq"};import l from"../../lib/magix.js";import s from"../../os/wallpaper.js";import a from"../../lib/agent.js";l.applyStyle("xlq",".xl-cm{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0;z-index:2}.xl-cn{float:left;padding:0 5px;cursor:pointer}.xl-co{background:#fff}.xl-cp{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer;background-color:hsla(0,0%,53.3%,.07);transition:all .2s}.xl-cp:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08);transform:scale(1.05)}.xl-cq{display:table}");let r=null,c=0,o=[],p=t=>{let e=t.split("x"),i=0|e[0],l=0|e[1],s=350/i,a=200/l,r=s>a?a:s;return{width:i*r|0,height:l*r|0}};export default l.View.extend({tmpl:(l,s,a,r,c,o,p,d)=>{let n,h,g,x,u,m,f=[],{error:b,cats:_,cId:w,loading:y,list:k,resize:v}=l;if(b)n=[s(0,0,r(b))],f.push(...n);else{n=[],g=[];for(let t=_.length,e=0;e<t;e++){let t=_[e];m=[s(0,0,r(t.name))],u="xl-cn",t.id==w&&(u+=" xl-co"),x=[s("div",{"mx-click":t.id!=w&&a+"\x1e_cb({id:'"+d(t.id)+"'})",class:u},m)],g.push(...x)}if(n.push(s("div",e,g)),y)t?g=[t]:(x=[s(0,0,"loading...")],g=[t=s("div",{_:"_",class:"xl-v"},x)]),n.push(...g);else{x=[];for(let t=k.length,e=0;e<t;e++){let t=k[e];h="";let i=v(t.resolution),l=i.width,c=i.height;h+=" ";let o=t.url.replace("bdr/__85",`bdr/${l}_${c}_80`);m=[s("div",{class:"xl-cp",style:"background-image:url("+r(o)+")",title:r(t.utag),"mx-click":a+"\x1e_aq({thumb:'"+d(o)+"',src:'"+d(t.url)+"'})"})],x.push(...m)}g=[s("div",i,x),s("div",{_:"a","mx-intersect":a+"\x1e_aQ()","mx-view":"~xl/gallery/mx-more/index"})],n.push(...g)}f.push(...n)}return s(a,0,f)},init(){this.set({size:20,start:0,list:[],resize:p})},assign:()=>!1,async render(){try{let t=await(()=>new Promise(async(t,e)=>{if(r)t(r);else if(c)o.push([t,e]);else{c=1,o.push([t,e]);try{let t=await a.request("http://wallpaper.apc.360.cn/index.php?c=WallPaperAndroid&a=getAllCategories",864e5,!0),e=JSON.parse(t);c=0;for(let[t]of o)t(r=e.data)}catch(t){c=0;for(let[,e]of o)e(t)}}}))(),e=this.get("cId"),i=l.mark(this,"_aO");e||(e=t[0].id);let s=this.get("start"),p=this.get("list"),d=this.get("size"),n=await(async(t,e,i)=>{let l=await a.request(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`,0,!0);return JSON.parse(l)})(e,s,d);i()&&(p.push(...n.data),this.digest({cId:e,loading:!1,cats:t,list:p}))}catch(t){this.digest({error:t})}delete this._aP},"_cb<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,start:0,cId:e}),this.root.scrollTop=0,this.render()},"_aq<click>"(t){let{thumb:e,src:i}=t.params;s._al(e,i)},"_aQ<intersect>"(){if(!this.get("loading")&&!this._aP){this._aP=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}});