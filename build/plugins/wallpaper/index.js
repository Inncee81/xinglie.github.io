/*!1.0.5 kooboy_li@163.com*/
import"../../gallery/mx-more/index.js";let t,e={class:"xl-cX"},i={class:"xl-da"};import s from"../../lib/magix.js";import l from"../../os/wallpaper.js";import a from"../../lib/agent.js";s.applyStyle("xl-r",".xl-cX{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0;z-index:2}.xl-cY{float:left;padding:0 5px;cursor:pointer}.xl-cZ{background:#fff}.xl-d_{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer;background-color:hsla(0,0%,53.3%,.07);-webkit-transition:all .2s;transition:all .2s}.xl-d_:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08);-webkit-transform:scale(1.05);transform:scale(1.05)}.xl-da{display:table}");let r=null,d=0,o=[],c=t=>{let e=t.split("x"),i=0|e[0],s=0|e[1],l=350/i,a=200/s,r=l>a?a:l;return{width:i*r|0,height:s*r|0}};export default s.View.extend({tmpl:(s,l,a,r,d,o,c,p)=>{let n,h,g,x,u,m,f=[],{error:_,cats:b,cId:w,loading:k,list:y,resize:v}=s;if(_)n=[l(0,0,r(_))],f.push(...n);else{n=[],g=[];for(let t=b.length,e=0;e<t;e++){let t=b[e];m=[l(0,0,r(t.name))],u="xl-cY",t.id==w&&(u+=" xl-cZ"),x=[l("div",{"mx-click":t.id!=w&&a+"\x1e_cf({id:'"+p(t.id)+"'})",class:u},m)],g.push(...x)}if(n.push(l("div",e,g)),k)t?g=[t]:(x=[l(0,0,"loading...")],g=[t=l("div",{_:"_",class:"xl-w"},x)]),n.push(...g);else{x=[];for(let t=y.length,e=0;e<t;e++){let t=y[e];h="";let i=v(t.resolution),s=i.width,d=i.height;h+=" ";let o=t.url.replace("bdr/__85",`bdr/${s}_${d}_80`);m=[l("div",{class:"xl-d_",style:"background-image:url("+r(o)+")",title:r(t.utag),"mx-click":a+"\x1e_ar({thumb:'"+p(o)+"',src:'"+p(t.url)+"'})"})],x.push(...m)}g=[l("div",i,x),l("div",{_:"a","mx-intersect":a+"\x1e_aT()","mx-view":"~xl/gallery/mx-more/index"})],n.push(...g)}f.push(...n)}return l(a,0,f)},init(){this.set({size:20,start:0,list:[],resize:c})},assign:()=>!1,async render(){try{let t=await(()=>new Promise(async(t,e)=>{if(r)t(r);else if(d)o.push([t,e]);else{d=1,o.push([t,e]);try{let t=await a.request("http://wallpaper.apc.360.cn/index.php?c=WallPaperAndroid&a=getAllCategories",864e5,!0),e=JSON.parse(t);d=0;for(let[t]of o)t(r=e.data)}catch(t){d=0;for(let[,e]of o)e(t)}}}))(),e=this.get("cId"),i=s.mark(this,"_aR");e||(e=t[0].id);let l=this.get("start"),c=this.get("list"),p=this.get("size"),n=await(async(t,e,i)=>{let s=await a.request(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`,0,!0);return JSON.parse(s)})(e,l,p);i()&&(c.push(...n.data),this.digest({cId:e,loading:!1,cats:t,list:c}))}catch(t){this.digest({error:t})}delete this._aS},"_cf<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,start:0,cId:e}),this.root.scrollTop=0,this.render()},"_ar<click>"(t){let{thumb:e,src:i}=t.params;l._am(e,i)},"_aT<intersect>"(){if(!this.get("loading")&&!this._aS){this._aS=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}});