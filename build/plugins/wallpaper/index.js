/*!1.0.2 kooboy_li@163.com*/
let t,e,i={class:"xl-bX"},l={class:"xl-ca"};import s from"../../lib/magix.js";import a from"../../os/wallpaper.js";import r from"../../lib/agent.js";s.applyStyle("xlp",".xl-bX{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0;z-index:2}.xl-bY{float:left;padding:0 5px;cursor:pointer}.xl-bZ{background:#fff}.xl-c_{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer;background-color:hsla(0,0%,53.3%,.07);transition:all .2s}.xl-c_:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08);transform:scale(1.05)}.xl-ca{display:table}.xl-cb{font-size:20px;text-align:center;height:40px;line-height:40px}");let o=null,p=0,c=[],h=t=>{let e=t.split("x"),i=0|e[0],l=0|e[1],s=350/i,a=200/l,r=s>a?a:s;return{width:i*r|0,height:l*r|0}};export default s.View.extend({tmpl:(s,a,r,o,p,c,h,d)=>{let n,g,x,u,f,b,_=[],{error:m,cats:w,cId:k,loading:y,list:v,resize:z}=s;if(m)n=[a(0,0,o(m))],_.push(...n);else{n=[],x=[];for(let t=w.length,e=0;e<t;e++){let t=w[e];b=[a(0,0,o(t.name))],f="xl-bY",t.id==k&&(f+=" xl-bZ"),u=[a("div",{"mx-click":t.id!=k&&r+"\x1e_c_({id:'"+d(t.id)+"'})",class:f},b)],x.push(...u)}if(n.push(a("div",i,x)),y)t?x=[t]:(u=[a(0,0,"loading...")],x=[t=a("div",{_:"_",class:"xl-v"},u)]),n.push(...x);else{u=[];for(let t=v.length,e=0;e<t;e++){let t=v[e];g="";let i=z(t.resolution),l=i.width,s=i.height;g+=" ";let p=t.url.replace("bdr/__85",`bdr/${l}_${s}_80`);b=[a("div",{class:"xl-c_",style:"background-image:url("+o(p)+")",title:o(t.utag),"mx-click":r+"\x1e_aq({thumb:'"+d(p)+"',src:'"+d(t.url)+"'})"})],u.push(...b)}x=[a("div",l,u)],e?x.push(e):(u=[a(0,0,"\u66f4\u591a\u52a0\u8f7d\u4e2d...")],x.push(e=a("div",{_:"a",class:"xl-cb"},u))),n.push(...x)}_.push(...n)}return a(r,0,_)},init(){this.set({size:20,start:0,list:[],resize:h})},async render(){try{let t=await(()=>new Promise(async(t,e)=>{if(o)t(o);else if(p)c.push([t,e]);else{p=1,c.push([t,e]);try{let t=await r.request("http://wallpaper.apc.360.cn/index.php?c=WallPaperAndroid&a=getAllCategories",864e5,!0),e=JSON.parse(t);p=0;for(let[t]of c)t(o=e.data)}catch(t){p=0;for(let[,e]of c)e(t)}}}))(),e=this.get("cId"),i=s.mark(this,"_aP");e||(e=t[0].id);let l=this.get("start"),a=this.get("list"),h=this.get("size"),d=await(async(t,e,i)=>{let l=await r.request(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`,0,!0);return JSON.parse(l)})(e,l,h);i()&&(a.push(...d.data),this.digest({cId:e,loading:!1,cats:t,list:a}))}catch(t){this.digest({error:t})}delete this._aN},"_c_<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,start:0,cId:e}),this.root.scrollTop=0,this.render()},"_aq<click>"(t){let{thumb:e,src:i}=t.params;a._al(e,i)},"$win<scroll>&capture"(t){if(t.target==this.root&&!this.get("loading")&&!this._aN){let t=this.root;if(t.scrollTop+t.offsetHeight+200>t.scrollHeight){this._aN=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}}});