let t,e={class:"xl-bp"};var i=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(l,r){function a(t){try{n(s.next(t))}catch(t){r(t)}}function o(t){try{n(s.throw(t))}catch(t){r(t)}}function n(t){t.done?l(t.value):new i(function(e){e(t.value)}).then(a,o)}n((s=s.apply(t,e||[])).next())})};import s from"../../lib/magix.js";s.applyStyle("xlk",".xl-bp{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0}.xl-bq{float:left;padding:0 5px;cursor:pointer}.xl-br{background:#fff}.xl-bs{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer}.xl-bs:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08)}");let l=null,r=0,a=[];export default s.View.extend({tmpl:(i,s,l,r,a,o,n,c)=>{let h,p,d,u,g,f=[],{error:x,cats:b,cId:m,loading:_,list:k}=i;if(x)h=[s(0,0,r(x))],f.push(...h);else{h=[],p=[];for(let t=0,e=b,i=e.length;t<i;t++){let i=e[t];g=[s(0,0,r(i.name))],u="xl-bq",i.id==m&&(u+=" xl-br"),d=[s("div",{"mx-click":i.id!=m&&l+"\x1e_bB({id:'"+c(i.id)+"'})",class:u},g)],p.push(...d)}if(h.push(s("div",e,p)),_)t?p=[t]:(d=[s(0,0,"loading...")],p=[t=s("div",{_:"_",class:"xl-v"},d)]),h.push(...p);else{p=[];for(let t=0,e=k,i=e.length;t<i;t++){let i=e[t],a=i.url.replace("bdr/__85","bdr/400_240_80");d=[s("div",{class:"xl-bs",style:"background-image:url("+r(a)+")","mx-click":l+"\x1e_a_({thumb:'"+c(a)+"',src:'"+c(i.url)+"'})"})],p.push(...d)}h.push(...p)}f.push(...h)}return s(l,0,f)},init(){this.set({size:20,start:0,list:[]})},render(){return i(this,void 0,void 0,function*(){try{let t=yield(()=>new Promise((t,e)=>{l?t(l):r?a.push([t,e]):(r=1,a.push([t,e]),fetch("https://jsonp.afeld.me/?url=http%3A%2F%2Fwallpaper.apc.360.cn%2Findex.php%3Fc%3DWallPaperAndroid%26a%3DgetAllCategories").then(t=>t.json()).then(t=>{r=0;for(let[e]of a)e(l=t.data)}).catch(t=>{r=0;for(let[,e]of a)e(t)}))}))(),e=this.get("cId"),i=s.mark(this,"_ar");e||(e=t[0].id);let o=this.get("start"),n=this.get("list"),c=this.get("size"),h=yield((t,e,i)=>fetch(`https://jsonp.afeld.me/?url=${encodeURIComponent(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`)}`).then(t=>t.json()))(e,o,c);i()&&(n.push(...h.data),delete this._bz,this.digest({cId:e,loading:!1,cats:t,list:n}))}catch(t){delete this._bz,this.digest({error:t})}})},"_bB<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,cId:e}),this.root.scrollTop=0,this.render()},"_a_<click>"(t){let{thumb:e,src:i}=t.params,l=s.node("g_bg");l.style.backgroundImage=`url(${e})`,l.innerHTML=`<img src="${i}" class="xl-_"/>`},"$win<scroll>&capture"(t){if(t.target==this.root&&!this._bz){let t=this.root;if(t.scrollTop+t.offsetHeight+200>t.scrollHeight){this._bz=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}}});