let t,e={class:"xl-bq"};var i=this&&this.__awaiter||function(t,e,i,l){return new(i||(i=Promise))(function(s,r){function a(t){try{n(l.next(t))}catch(t){r(t)}}function o(t){try{n(l.throw(t))}catch(t){r(t)}}function n(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(a,o)}n((l=l.apply(t,e||[])).next())})};import l from"../../lib/magix.js";import s from"../../os/wallpaper.js";l.applyStyle("xlk",".xl-bq{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0}.xl-br{float:left;padding:0 5px;cursor:pointer}.xl-bs{background:#fff}.xl-bt{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer;background-color:hsla(0,0%,53.3%,.07)}.xl-bt:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08)}");let r=null,a=0,o=[];export default l.View.extend({tmpl:(i,l,s,r,a,o,n,h)=>{let c,p,d,u,g,f=[],{error:b,cats:x,cId:m,loading:_,list:k}=i;if(b)c=[l(0,0,r(b))],f.push(...c);else{c=[],p=[];for(let t=0,e=x,i=e.length;t<i;t++){let i=e[t];g=[l(0,0,r(i.name))],u="xl-br",i.id==m&&(u+=" xl-bs"),d=[l("div",{"mx-click":i.id!=m&&s+"\x1e_bF({id:'"+h(i.id)+"'})",class:u},g)],p.push(...d)}if(c.push(l("div",e,p)),_)t?p=[t]:(d=[l(0,0,"loading...")],p=[t=l("div",{_:"_",class:"xl-v"},d)]),c.push(...p);else{p=[];for(let t=0,e=k,i=e.length;t<i;t++){let i=e[t],a=i.url.replace("bdr/__85","bdr/400_240_80");d=[l("div",{class:"xl-bt",style:"background-image:url("+r(a)+")","mx-click":s+"\x1e_ad({thumb:'"+h(a)+"',src:'"+h(i.url)+"'})"})],p.push(...d)}c.push(...p)}f.push(...c)}return l(s,0,f)},init(){this.set({size:20,start:0,list:[]})},render(){return i(this,void 0,void 0,function*(){try{let t=yield(()=>new Promise((t,e)=>{r?t(r):a?o.push([t,e]):(a=1,o.push([t,e]),fetch("https://jsonp.afeld.me/?url=http%3A%2F%2Fwallpaper.apc.360.cn%2Findex.php%3Fc%3DWallPaperAndroid%26a%3DgetAllCategories").then(t=>t.json()).then(t=>{a=0;for(let[e]of o)e(r=t.data)}).catch(t=>{a=0;for(let[,e]of o)e(t)}))}))(),e=this.get("cId"),i=l.mark(this,"_av");e||(e=t[0].id);let s=this.get("start"),n=this.get("list"),h=this.get("size"),c=yield((t,e,i)=>fetch(`https://jsonp.afeld.me/?url=${encodeURIComponent(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`)}`).then(t=>t.json()))(e,s,h);i()&&(n.push(...c.data),delete this._bD,this.digest({cId:e,loading:!1,cats:t,list:n}))}catch(t){delete this._bD,this.digest({error:t})}})},"_bF<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,cId:e}),this.root.scrollTop=0,this.render()},"_ad<click>"(t){let{thumb:e,src:i}=t.params;s._ab(e,i)},"$win<scroll>&capture"(t){if(t.target==this.root&&!this._bD){let t=this.root;if(t.scrollTop+t.offsetHeight+200>t.scrollHeight){this._bD=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}}});