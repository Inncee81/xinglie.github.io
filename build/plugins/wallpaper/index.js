let t,e,i={class:"xl-bv"},l={class:"xl-bz"};var s=this&&this.__awaiter||function(t,e,i,l){return new(i||(i=Promise))(function(s,r){function a(t){try{n(l.next(t))}catch(t){r(t)}}function o(t){try{n(l.throw(t))}catch(t){r(t)}}function n(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(a,o)}n((l=l.apply(t,e||[])).next())})};import r from"../../lib/magix.js";import a from"../../os/wallpaper.js";r.applyStyle("xlk",".xl-bv{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0;z-index:2}.xl-bw{float:left;padding:0 5px;cursor:pointer}.xl-bx{background:#fff}.xl-by{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer;background-color:hsla(0,0%,53.3%,.07);transition:all .2s}.xl-by:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08);transform:scale(1.05)}.xl-bz{display:table}.xl-bA{font-size:20px;text-align:center;height:40px;line-height:40px}");let o=null,n=0,h=[],p=t=>{let e=t.split("x"),i=0|e[0],l=0|e[1],s=350/i,r=200/l,a=s>r?r:s;return{width:i*a|0,height:l*a|0}};export default r.View.extend({tmpl:(s,r,a,o,n,h,p,c)=>{let d,u,g,x,b,f,m=[],{error:_,cats:w,cId:y,loading:v,list:k,resize:z}=s;if(_)d=[r(0,0,o(_))],m.push(...d);else{d=[],g=[];for(let t=0,e=w,i=e.length;t<i;t++){let i=e[t];f=[r(0,0,o(i.name))],b="xl-bw",i.id==y&&(b+=" xl-bx"),x=[r("div",{"mx-click":i.id!=y&&a+"\x1e_bH({id:'"+c(i.id)+"'})",class:b},f)],g.push(...x)}if(d.push(r("div",i,g)),v)t?g=[t]:(x=[r(0,0,"loading...")],g=[t=r("div",{_:"_",class:"xl-v"},x)]),d.push(...g);else{x=[];for(let t=0,e=k,i=e.length;t<i;t++){let i=e[t];u="";let l=z(i.resolution),s=l.width,n=l.height;u+=" ";let h=i.url.replace("bdr/__85",`bdr/${s}_${n}_80`);f=[r("div",{class:"xl-by",style:"background-image:url("+o(h)+")",title:o(i.utag),"mx-click":a+"\x1e_ad({thumb:'"+c(h)+"',src:'"+c(i.url)+"'})"})],x.push(...f)}g=[r("div",l,x)],e?g.push(e):(x=[r(0,0,"\u66f4\u591a\u52a0\u8f7d\u4e2d...")],g.push(e=r("div",{_:"a",class:"xl-bA"},x))),d.push(...g)}m.push(...d)}return r(a,0,m)},init(){this.set({size:20,start:0,list:[],resize:p})},render(){return s(this,void 0,void 0,function*(){try{let t=yield(()=>new Promise((t,e)=>{o?t(o):n?h.push([t,e]):(n=1,h.push([t,e]),fetch("https://jsonp.afeld.me/?url=http%3A%2F%2Fwallpaper.apc.360.cn%2Findex.php%3Fc%3DWallPaperAndroid%26a%3DgetAllCategories").then(t=>t.json()).then(t=>{n=0;for(let[e]of h)e(o=t.data)}).catch(t=>{n=0;for(let[,e]of h)e(t)}))}))(),e=this.get("cId"),i=r.mark(this,"_av");e||(e=t[0].id);let l=this.get("start"),s=this.get("list"),a=this.get("size"),p=yield((t,e,i)=>fetch(`https://jsonp.afeld.me/?url=${encodeURIComponent(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`)}`).then(t=>t.json()))(e,l,a);i()&&(s.push(...p.data),delete this._bF,this.digest({cId:e,loading:!1,cats:t,list:s}))}catch(t){delete this._bF,this.digest({error:t})}})},"_bH<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,cId:e}),this.root.scrollTop=0,this.render()},"_ad<click>"(t){let{thumb:e,src:i}=t.params;a._ab(e,i)},"$win<scroll>&capture"(t){if(t.target==this.root&&!this._bF){let t=this.root;if(t.scrollTop+t.offsetHeight+200>t.scrollHeight){this._bF=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}}});