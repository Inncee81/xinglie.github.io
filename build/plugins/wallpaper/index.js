/*!1.1.0 kooboy_li@163.com*/
import"../../gallery/mx-more/index.js";let t,e={class:"xl-cz"},i={class:"xl-cD"};import s from"../../lib/magix.js";import l from"../../os/wallpaper.js";import a from"../../lib/agent.js";s.applyStyle("xl-s",".xl-cz{height:28px;line-height:28px;padding:0 26px;background:#ddd;color:#333;position:-webkit-sticky;position:sticky;top:0;z-index:2}.xl-cA{float:left;padding:0 5px;cursor:pointer}.xl-cB{background:#fff}.xl-cC{width:350px;height:200px;float:left;margin:5px;background-repeat:no-repeat;background-size:contain;cursor:pointer;background-color:hsla(0,0%,53.3%,.07);transition:all .2s}.xl-cC:hover{box-shadow:0 3px 6px 0 rgba(0,0,0,.08);transform:scale(1.05)}.xl-cD{display:table}");let r=null,c=0,o=[],p=t=>{let e=t.split("x"),i=0|e[0],s=0|e[1],l=350/i,a=200/s,r=l>a?a:l;return{width:i*r|0,height:s*r|0}};export default s.View.extend({tmpl:(s,l,a,r,c,o,p,d)=>{let h,n,g,x,u,m,f=[],{error:b,cats:_,cId:w,loading:y,list:k,resize:z}=s;if(b)h=[l(0,0,r(b))],f.push(...h);else{h=[],g=[];for(let t=_.length,e=0;e<t;e+=1){let t=_[e];m=[l(0,0,r(t.name))],u="xl-cA",t.id==w&&(u+=" xl-cB"),x=[l("div",{"mx5-click":t.id!=w&&a+"\x1e_bV({id:'"+d(t.id)+"'})",class:u},m)],g.push(...x)}if(h.push(l("div",e,g)),y)t?g=[t]:(x=[l(0,0,"loading...")],g=[t=l("div",{_:"_",class:"xl-w"},x)]),h.push(...g);else{x=[];for(let t=k.length,e=0;e<t;e+=1){let t=k[e];n="";let i=z(t.resolution),s=i.width,c=i.height;n+=" ";let o=t.url.replace("bdr/__85",`bdr/${s}_${c}_80`);m=[l("div",{class:"xl-cC",style:"background-image:url("+r(o)+")",title:r(t.utag),"mx5-click":a+"\x1e_ah({thumb:'"+d(o)+"',src:'"+d(t.url)+"'})"})],x.push(...m)}g=[l("div",i,x),l("div",{"mx5-intersect":a+"\x1e_aJ()","mx5-view":"~xl/gallery/mx-more/index"})],h.push(...g)}f.push(...h)}return l(a,0,f)},init(){this.set({size:20,start:0,list:[],resize:p})},assign:()=>!1,async render(){try{let t=await(()=>new Promise(async(t,e)=>{if(r)t(r);else if(c)o.push([t,e]);else{c=1,o.push([t,e]);try{let t=await a.request("http://wallpaper.apc.360.cn/index.php?c=WallPaperAndroid&a=getAllCategories",864e5,!0),e=JSON.parse(t);c=0;for(let[t]of o)t(r=e.data)}catch(t){c=0;for(let[,e]of o)e(t)}}}))(),e=this.get("cId"),i=s.mark(this,"_aH");e||(e=t[0].id);let l=this.get("start"),p=this.get("list"),d=this.get("size"),h=await(async(t,e,i)=>{let s=await a.request(`http://wallpaper.apc.360.cn/index.php?c=WallPaper&a=getAppsByCategory&cid=${t}&start=${e}&count=${i}`,0,!0);return JSON.parse(s)})(e,l,d);i()&&(p.push(...h.data),this.digest({cId:e,loading:!1,cats:t,list:p}))}catch(t){this.digest({error:t})}delete this._aI},"_bV<click>"(t){let{id:e}=t.params;this.digest({list:[],loading:!0,start:0,cId:e}),this.root.scrollTop=0,this.render()},"_ah<click>"(t){let{thumb:e,src:i}=t.params;l._ac(e,i)},"_aJ<intersect>"(){if(!this.get("loading")&&!this._aI){this._aI=1;let t=this.get("start")+this.get("size");this.set({start:t}),this.render()}}});